# ========================
# Deny by default
# ========================
Order Deny,Allow
Deny from all

# Allow error page
<Files "403.html">
    Order Allow,Deny
    Allow from all
</Files>

# ========================
# Allow from specific IP ranges (check X-Forwarded-For header or direct IP)
# ========================

# Existing rules
SetEnvIf X-Forwarded-For "76\.257\.180\.5" AllowIP
SetEnvIf X-Forwarded-For "182\.70\.120\.222" AllowIP
SetEnvIf X-Forwarded-For "^49\.36\.58\.172\b" AllowIP
SetEnvIf X-Forwarded-For "^76\.247\.180\.5\b" AllowIP

# 101 Block
# Blaze
SetEnvIf X-Forwarded-For "111\.125\.249\.208" AllowIP
# Jio
SetEnvIf X-Forwarded-For "115\.246\.37\.2" AllowIP
# Airtel
SetEnvIf X-Forwarded-For "182\.70\.120\.112" AllowIP
SetEnvIf X-Forwarded-For "182\.70\.120\.115" AllowIP

# 402 Block
# Blaze
SetEnvIf X-Forwarded-For "111\.125\.249\.222" AllowIP
# Airtel
SetEnvIf X-Forwarded-For "122\.170\.112\.105" AllowIP

# Pranjal IPv4
SetEnvIf X-Forwarded-For "49\.36\.58\.172" AllowIP

# Anshuman IPv4
SetEnvIf X-Forwarded-For "160\.238\.93\.218" AllowIP

# New IPv4 (requested)
SetEnvIf X-Forwarded-For "152\.59\.63\.169" AllowIP
# Prathim IP
SetEnvIf X-Forwarded-For "103\.175\.63\.219" AllowIP  

# Sourav IP
SetEnvIf X-Forwarded-For "152\.58\.176\.156" AllowIP  


# IPv6 (direct and proxy header)
Allow from 2405:201:1016:6102:d50f:7f8a:cb3b:3a13
SetEnvIf X-Forwarded-For "2405:201:1016:6102:d50f:7f8a:cb3b:3a13" AllowIP

# New IPv6 (requested)
Allow from 2409:40c2:1021:e51:c8d6:199c:de78:afd9
SetEnvIf X-Forwarded-For "2409:40c2:1021:e51:c8d6:199c:de78:afd9" AllowIP
# IPv6 Allow
SetEnvIf X-Forwarded-For "2405:201:1016:6102:dd74:a6fa:720d:87e" AllowIP

# Final allow rule
Allow from env=AllowIP
Allow from 127.0.0.1
Allow from ::1




# ========================
# Error document for denied access
# ========================
 ErrorDocument 403 /403.html
#  ErrorDocument 403 "Your IP address is: %{HTTP:X-Forwarded-For}"
# ========================
# Cache headers
# ========================
<IfModule mod_headers.c>
    <FilesMatch "\.(ico|pdf|flv|jpg|jpeg|png|gif|js|css|swf|json|webp|html)$">
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires "0"
    </FilesMatch>
</IfModule>

# ========================
# Rewrite rules
# ========================
<IfModule mod_rewrite.c>
    RewriteEngine On

    # Serve existing files/folders directly
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]

    # Fallback to index.html for SPA routes
    RewriteRule ^ index.html [L]

    # Force HTTPS
    RewriteCond %{HTTPS} off
    RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R,L]
</IfModule>

# ========================
# Enable compression
# ========================
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>
